<html>
<head>
<title>WebSocket</title>

<style>
 html,body{font:normal 0.9em arial,helvetica;}
 #msg {width:330px;}
 .signup { border: 1px solid #999999;
font: normal 14px helvetica; color:#444444; }
</style>
<script>
function validate() {
fail = validateFirstname($("firstname").value)
fail += validateLastname($("lastname").value)
fail += validateUsername($("username").value)
fail += validatePassword($("password").value)
fail += validateEmail($("email").value)
if (fail == "") return true
else { alert(fail); return false }
}
</script>
<script src="validate_functions.js"></script>
<script src="json.js"></script>
<script>
var socket;

function init(){
  var host = "ws://64.131.109.97:8081/socket/newsocket/server2.php";
  try{
    socket = new WebSocket(host);
    log('WebSocket - status '+socket.readyState);
    socket.onopen    = function(msg){ log("Welcome - status "+this.readyState); };
    socket.onmessage = function(msg){ log("Received: "+msg.data); };
    socket.onclose   = function(msg){ log("Disconnected - status "+this.readyState); };
  }
  catch(ex){ log(ex); }
// $("msg").focus();
}

function register() {
  var username = $("username").value;
  var firstname = $("firstname").value;
  var lastname = $("lastname").value;
  var password = $("password").value;
  var email = $("email").value;

  var param = {"username": username , "firstname" : firstname , "lastname" : lastname , "password" : password , "email" : email};
  
  //try { socket.send('POST /login/' + username + JSONstringify(param));} catch (ex) { log(ex); } //this is what we used initially
  //Dont think the stringify method works.....
  try { socket.send('POST /login/' + param)} catch (ex) { log(ex); }
}

function whoisonline() {
  username = $("msg").value;
  if (!username) { alert("Please type a username first"); return; }
  $("msg").value = "";
 // try { socket.send('GET /login' + username ); } catch (ex) { log(ex); }
  try { socket.send('GET /login'); } catch (ex) { log(ex); }
}

function send(){
  var txt,msg;
  txt = $("msg");
  msg = txt.value;
  if(!msg){ alert("Message can not be empty"); return; }
  txt.value="";
  txt.focus();
  try{ socket.send(msg); log('Sent: '+msg); } catch(ex){ log(ex); }
}
function quit(){
  log("Goodbye!");
  socket.close();
  socket=null;
}

// Utilities
function $(id){ return document.getElementById(id); }
function log(msg){ $("log").innerHTML+="<br>"+msg; }
function onkey(event){ if(event.keyCode==13){ send(); } }
</script>

</head>
<body onload="init()">
 <h3>WebSocket v2.00</h3>
 <div id="log"></div>
 <div>
 <table class="signup" border="0" cellpadding="2"
cellspacing="5" bgcolor="#eeeeee">
<th colspan="2" align="center">Signup Form</th>
<form method="post" action="">
<tr><td>Firstname</td><td><input type="text" maxlength="32"
name="firstname" id="firstname" /></td></tr>
<tr><td>Lastname</td><td><input type="text" maxlength="32"
name="lastname" id="lastname" /></td></tr>
<tr><td>Username</td><td><input type="text" maxlength="16"
name="username" id="username" /></td></tr>
<tr><td>Password</td><td><input type="password" maxlength="20"
name="password" id="password" /></td></tr>
<tr><td>Email</td><td><input type="text" maxlength="64"
name="email" id="email"/></td></tr>
<tr><td colspan="1" align="center">
<input type="button" value="Register" onclick="if (validate()){register();}"/></td>
<td colspan="1" align="center">
<input type="button" value="Who's online?" /></td>
</tr>
</form></table></div>
</body>
</html>
